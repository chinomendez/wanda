import { useState } from "react";
import { MdxLayout } from "@/components/layouts/mdx";
import { Playground } from "@/components/playground";
import { PropsTable } from "@/components/props-table";
import { Props } from "@/components/props";
import { LiveArea } from "@/components/live-area";
import * as Components from "@wonderflow/react-components";

export const example = `() => {
  const [checked, setChecked] = useState(false);
  return (
    <Dropdown
      placement="bottom-start"
      trigger={<Button kind="flat">Open dropdown</Button>}
    >
      <Menu>
        <Menu.Item autoFocus icon="user">Item option 1</Menu.Item>
        <Menu.ItemCheckbox
          onClick={() => setChecked(val => !val)}
          icon={checked ? 'check' : undefined}
          checked={checked}
        >
          Checkable option 2
        </Menu.ItemCheckbox>
        <Separator />
        <Menu.Item icon="right-from-bracket">
          Item option 3
        </Menu.Item>
        <Menu.Item disabled icon="right-from-bracket">
          Disabled option 4
        </Menu.Item>
      </Menu>
    </Dropdown>
  )
}`;

export default ({ children }) => (
  <MdxLayout
    title="Dropdown"
    description="Add extra actions to elements"
    showMeta
    features={[
      "Keyboard accessible",
      "Focus is fully managed",
      "Multiple sizes",
      "Supports custom element as dropdown",
      "Custom icons and icon position",
      "Auto placement based on viewport boundaries",
      "Themes ready",
    ]}
    links={[
      {
        label: "ARIA authoring",
        url: "https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton",
      },
    ]}
    hero={<Playground scope={{ ...Components, useState }} code={example} />}
  >
    {children}
  </MdxLayout>
);

## Anatomy

```tsx highlight=1,5-11
import { Dropdown, Button, Menu } from "@wonderflow/react-components";

export default () => {
  return (
    <Dropdown trigger={<Button>Open dropdown</Button>}>
      <Menu>
        <Menu.Item>Item option 1</Menu.Item>
        <Menu.Item>Item option 2</Menu.Item>
        <Menu.Item>Item option 3</Menu.Item>
      </Menu>
    </Dropdown>
  );
};
```


## Controlled dropdown

The `Dropdown` component can be controlled from the outside by using the `open` property. If set to `true`, the dropdown will be open once rendered, while passing `false` when it's open, it will force close.

export const PrgrammaticDropdown = () => {
  const [open, setOpen] = useState(false)
  return (
    <Components.Stack direction="row" columnGap={16} vAlign="center">
      <Components.Dropdown
        open={open}
        placement="bottom"
        onOpenChange={(state) => setOpen(state)}
        trigger={
          <Components.Button onClick={() => setOpen(open => !open)}>
            {`${open ? 'Close' : 'Open'} dropdown`}
          </Components.Button>
        }
      >
        <div style={{ background: 'var(--global-vibrancy-background-hard)', backdropFilter: 'blur(10px)', border: '2px solid black', maxInlineSize: '30ch', padding: 24 }}>
          Lorem ipsum dolor, sit amet consectetur adipisicing elit.
          Magni error unde sapiente beatae! Nostrum praesentium similique
          veniam non ut nulla, incidunt velit et, placeat cupiditate, aliquid saepe. Atque, provident perferendis? <br /><br />
          <Components.Button kind="secondary" dimension="small" onClick={() => setOpen(val => !val)}>
            Close dropdown
          </Components.Button>
        </div>
      </Components.Dropdown>
    </Components.Stack>
  );
};

<LiveArea>
  <PrgrammaticDropdown />
</LiveArea>

```tsx highlight=4,7-12,15-16
import { Dropdown, Button } from "@wonderflow/react-components";

export default () => {
  const [open, setOpen] = useState(false)

  return (
    <Dropdown
      open={open}
      onOpenChange={(state) => setOpen(state)}
      trigger={(
        <Button onClick={() => setOpen(!open)}>Open dropdown</Button>
      )}
    >
      ....

      <Button onClick={() => setOpen(false)}>Close</Button>
    </Dropdown>
  );
};
```

## API Reference

### Dropdown

<PropsTable
  properties={[
    {
      name: "trigger",
      type: ["ReactNode"],
      default: "",
      required: true,
      description: "The element to use as the trigger for the dropdown.",
    },
    {
      name: "offset",
      type: ["number"],
      default: "8",
      required: false,
      description: "The distance from the trigger to the dropdown.",
    },
    {
      name: "placement",
      type: ["enum"],
      typeValue: '"auto" | "auto-start" | "auto-end" | "top" | "bottom" | "right" | "left" | "top-start" | "top-end" | "bottom-start" | "bottom-end" | "right-start" | "right-end" | "left-start" | "left-end"',
      default: "auto-start",
      required: false,
      description:
        "The placement of the dropdown. This is automatically handled based on scroll and viewport edges. By default the dropdown is anchored at the beginning of the trigger. The first key refers to the X axis, the second key refers to the Y axis. Eg: `auto-start` means the dropdown will be placed automatically on left or right based on the available space, and anchored at the top (start) of the trigger.",
    },
    {
      name: "disabled",
      type: ["boolean"],
      default: "",
      required: false,
      description: "Enable or disable the itneraction on the trigger.",
    },
    {
      name: "open",
      type: ["boolean"],
      default: "",
      required: false,
      description: "Programmatically open or close the dropdown. If set to `true`, the dropdown will be open when rendered. This make the dropdown a controlled component.",
    },
    {
      name: "onOpenChange",
      type: ["function"],
      typeValue: "(open: boolean) => void",
      default: "",
      required: false,
      description: "Calllback triggered when the dropdown state changes. It returns the new `boolean` state.",
    },
    {
      name: "closeOnOutsideClick",
      type: ["boolean"],
      default: "true",
      required: false,
      description: "Enable or disable the auto close of the dropdown when clicking outside of it.",
    },
  ]}
/>

## Accessibility

Adheres to the [`menu button` role requirements](https://www.w3.org/TR/wai-aria-practices-1.2/#menubutton).

The `Dropdown` component accepts custom elements as children. This means that you can show your component as dropodown when the trigger is activated. Said that, if you're using custom elements you have to follow all the ARIA requirements and introduce the required behaviours, like focus handling (eg. using the autofocus attribute) and keyboard navigation with the [roving tabindex](https://developers.google.com/web/fundamentals/accessibility/focus/using-tabindex). There is also a [react package](https://www.npmjs.com/package/react-roving-tabindex) to easily handle this.

### Example

export const exampleCustom = `<Dropdown trigger={<Button>Open dropdown</Button>}>
  <>
    <p>Custom element</p>
    <Button autoFocus dimension="small" kind="flat">
      Another button
    </Button>
  </>
</Dropdown>`;

<Playground scope={{ ...Components }} code={exampleCustom} />

### Keyboard interactions

<Props
  properties={[
    {
      name: "tab",
      description:
        "Move focus on the trigger if closed. If opened move the focus inside the dropdown. If no focusable elements are found, move focus outside and close the dropdown.",
    },
    {
      name: "enter",
      description:
        "Open the menu and set the focus on the first focusable element inside the dropdown.",
    },
  ]}
/>
